## 概述

领域驱动设计也就是3D（Domain-Driven Design)已经有了10年的历史，我相信很多人或多或少都听说过这个名词，但是有多少人真正懂得如何去运用它，或者把它运用好呢？


## 一点废话 ，我们需要好的设计么？

一句话没有好好设计的代码，维护工作量巨大！


## 从设计阶段开始，站在业务的角度思考问题

除了DDD，现在还流行另外一个词汇TDD。但是不知道大家有没有注意到DDD（Domain-Driven Design)中的D代表着设计，
而TDD(Test-Driven Development)中的D代表着开发，你有没有曾几何时把领域驱动设计说成领域驱动开发呢？当然我们确实是可以根据领域驱动来开发，
但是DDD被设计出来的完美初衷却是设计。TDD强调的已经是开发了，要求开发人员先写单元测试然后再通过不断的迭代重构让单元测试通过，以此来实现功能。
这样做的好处是强迫让开发人员清楚正确的理解*需求*，要知道这年头没有正确理解需求就开始写代码的程序员大有人在，并且我不认为*需求*就是*业务*，
需求已经是将本来的业务理解之后，转化为了通过计算机可以实现的一些功能定义，通常是业务分析师或者项目经理会去完成这个工作。
而DDD中的D（领域）更像是本来的业务，所以在领域驱动设计的时候，开发人员或者架构师直接与领域专家（或者说客户）进行沟通来建模，
这些业务模型也是以后开发人员进行设计和实现的依据。

在DDD中，领域模型分为三种：

1. 实体
2. 值对象
3. 领域服务


## 区分实体、值对象和领域服务

实体相对于值对象而言拥有“*标识*”的概念，*标识*可以让我们持续性的跟踪实体。*标识*和数据库里面的“*主键*”是不一样的概念，
*主键*是技术上的概念，但是*标识*是业务上的概念。

解决完实体和值对象，领域服务就好说了，一些重要的领域操作，既不属于实体也不属于值对象，那就可以把它放到服务中了。
比如说我们上面的领域服务UserService里面的注册操作，注册这个操作可以说就是将这个用户保存到我们的系统中。
在注册之间，这个用户是不存在的，我们又怎么能把注册这个操作放到User实体中去呢？所以把它放到领域服务中成了我们最好的选择。

## 厘清业务主次-聚合与聚合根

在DDD中，我们把这样多个模型用关联串起来组成一个*聚合(aggregation)*。

*我们通过为每一个聚合选择一个根，并通过根来控制所有对边界内的对象的访问。外部对象只能持有根的引用；由于根控制了访问，因此我们无法绕过它去修改内部元素。*
我们后面还会说到只能为根来建立Repository，这也是为了确保我们这里面讲的数据的一致性。

## 独立领域业务层 - 高内聚，低耦合，可测试

DDD中使用的分层结构。

![](http://images.cnitblog.com/blog/554526/201409/042138567821588.png)

关于这个分层，每一层是干什么的，具体怎么玩，大家可以看一下dax的[这一篇文章](http://www.cnblogs.com/daxnet/archive/2010/07/07/1772584.html)讲解的很清楚。
总之，我们的领域模型以及相关的类比如工厂等会被独立成为一层来与应用层和基础设计层交互。
![](http://images.cnitblog.com/blog/554526/201409/042144328285723.png)


那么我们如何避免领域层对基础设施层的依懒呢？
感谢面向对象设计 - 面向接口编程，只不过这里面的场景特别有代表性，它是一个非常常见的问题，于是它成为了一个模式：仓储（Repository)。
``` C#
namespace RepositoryAndEf.Core.Data
{
    public partial interface IRepository<T> where T : BaseEntity
    {
        T GetById(object id);

        IEnumerable<T> Get(
            Expression<Func<T, Boolean>> predicate);

        bool Insert(T entity);
        bool Update(T entity);
        bool Delete(T entity);
    }
}
```

Repository让我们专注于模型，不用去考虑持久化的问题。更为重要的一点是，因为它是接口，
所以我们可以很方便的替代它，或者模拟一个实现来对我们的领域模型进行单元测试。


## 干净漂亮的代码

经常有人说代码是一件艺术，码农都是艺术家。我很喜欢这句话，如果你也认同，那就请像对待艺术品一样对待我们的代码，精心的打磨它。并且你不一定要非常的有经验才可以干这件事情；







[初探领域驱动设计（1）为复杂业务而生 ](http://www.cnblogs.com/jesse2013/p/the-first-glance-of-ddd.html)